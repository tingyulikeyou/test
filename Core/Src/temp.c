#include "main.h"



extern uint16_t g_VefIntAvergeVolt;


const uint32_t Risister_table[]=
{

	//K OHMS
	1792666,	//-30
	1684053,	//-29
	1582726,	//-28
	1488151,	//-27
	1399837,	//-26
	1317332,	//-25
	1240216,	//-24
	1168107,	//-23
	1100648,	//-22
	1037512,	//-21
	978396,	//-20
	923020,	//-19
	871124,	//-18
	822471,	//-17
	776837,	//-16
	734018,	//-15
	693823,	//-14
	656077,	//-13
	620616,	//-12
	587288,	//-11
	555953,	//-10
	526480,	//-9
	498747,	//-8
	472643,	//-7
	448062,	//-6
	424906,	//-5
	403086,	//-4
	382516,	//-3
	363117,	//-2
	344817,	//-1
	327547,	//0
	311243,//	//1
	295847,//	//2
	281301,//	//3
	267556,//	//4
	254562,	//5
	242274,	//6
	230650,	//7
	219650,	//8
	209239,	//9
	199380,	//10
	190041,	//11
	181193,	//12
	172807,	//13
	164857,	//14
	157317,	//15
	150164,	//16
	143376,	//17
	136933,	//18
	130816,	//19
	125005,	//20
	119485,	//21
	114239,	//22
	109252,	//23
	104510,	//24
	100000,	//25
	95709,	//26
	91626,	//27
	87738,	//28
	84037,	//29
	80512,	//30
	77154,	//31
	73953,	//32
	70903,	//33
	67995,	//34
	65221,	//35
	62576,	//36
	60051,	//37
	57642,	//38
	55342,	//39
	53146,	//40
	51049,	//41
	49045,	//42
	47130,	//43
	45300,	//44
	43551,	//45
	41878,	//46
	40278,	//47
	38748,	//48
	37283,	//49
	35882,	//50
	34540,	//51
	33255,	//52
	32025,	//53
	30846,	//54
	29717,	//55
	28635,	//56
	27597,	//57
	26603,	//58
	25649,	//59
	24734,	//60
	23856,	//61
	23014,	//62
	22206,	//63
	21431,	//64
	20686,	//65
	19970,	//66
	19283,	//67
	18623,	//68
	17989,	//69
	17380,	//70
	16794,	//71
	16231,	//72
	15689,	//73
	15168,	//74
	14667,	//75
	14185,	//76
	13722,	//77
	13275,	//78
	12845,	//79
	12431,	//80
	12033,	//81
	11649,	//82
	11279,	//83
	10923,	//84
	10580,	//85
	10249,	//86
	 9930,	//87
	 9623,	//88
	 9326,	//89
	 9040,	//90
	 8764,	//91
	 8498,	//92
	 8241,	//93
	 7994,	//94
	 7754,	//95
	 7523,	//96
	 7300,	//97
	 7085,	//98
	 6877,	//99
	 6676,	//100
	 6482,	//101
	 6295,	//102
	 6113,	//103
	 5938,	//104
	 5769,	//105

	 5605,	//106
	 5447,	//107
	 5293,	//108
	 5145,	//109
	 5002,	//110
	 4863,	//111
	 4729,	//112
	 4599,	//113
	 4474,	//114
	 4352,	//115
	 4234,	//116
	 4120,	//117
	 4009,	//118
	 3902,	//119
	 3799,	//120
	 3698,	//121
	 3601,	//122
	 3506,	//123
	 3415,	//124
	 3326,	//125
	 3240,	//126
	 3157,	//127
	 3076,	//128
	 2998,	//129
	 2922,	//130
	 2848,	//131
	 2776,	//132
	 2707,	//133
	 2640,	//134
	 2574,	//135
	 2511,	//136
	 2449,	//137
	 2389,	//138
	 2331,	//139
	 2274,	//140
	 2220,	//141
	 2166,	//142
	 2114,	//143
	 2064,	//144
	 2015,	//145
	 1968,	//146
	 1922,	//147
	 1877,	//148
	 1833,	//149
	 1791,	//150
	 1749,	//151
	 1709,	//152
	 1670,	//153
	 1632,	//154
	 1595,	//155
	 1559,	//156
	 1524,	//157
	 1490,	//158
	 1457,	//159
	 1425,	//160
	 1394,	//161
	 1363,	//162
	 1333,	//163
	 1304,	//164
	 1276,	//165
	 1249,	//166
	 1222,	//167
	 1196,	//168
	 1170,	//169
	 1146,	//170
	 1121,	//171
	 1098,	//172
	 1075,	//173
	 1053,	//174
	 1031,	//175
	 1010,	//176
	  989,	//177
	  969,	//178
	  949,	//179
	  930,	//180
	  911,	//181
	  893,	//182
	  875,	//183
	  858,	//184
	  841,	//185
	  824,	//186
	  808,	//187
	  792,	//188
	  777,	//189
	  762,	//190
	  747,	//191
	  733,	//192
	  719,	//193
	  705,	//194
	  692,	//195
	  679,	//196
	  666,	//197
	  654,	//198
	  642,	//199
	  630,	//200
	  618,	//201
	  607,	//202
	  596,	//203
	  585,	//204
	  574,	//205
	  564,	//206
	  554,	//207
	  544,	//208
	  534,	//209
	  525,	//210
	  516,	//211
	  507,	//212
	  498,	//213
	  489,	//214
	  481,	//215
	  473,	//216
	  464,	//217
	  456,	//218
	  449,	//219
	  441,	//220
	  434,	//221
	  426,	//222
	  419,	//223
	  412,	//224
	  406,	//225
	  399,	//226
	  392,	//227
	  386,	//228
	  380,	//229
	  374,	//230
	  368,	//231
	  362,	//232
	  356,	//233
	  350,	//234
	  345,	//235
	  339,	//236
	  334,	//237
	  329,	//238
	  324,	//239
	  319,	//240
	  314,	//241
	  309,	//242
	  304,	//243
	  300,	//244
	  295,	//245
	  291,	//246
	  286,	//247
	  282,	//248
	  278,	//249
	  274,	//250
};

	uint16_t i=0;
	uint32_t risister,volt,battery;
	int16_t temp=-1000;
int16_t TempCal(uint16_t adc,uint16_t resister)
{

	 battery=g_VefIntAvergeVolt;

	 if(battery>3500)  
		battery=3300;

	 volt=(uint32_t) adc*(uint32_t)battery/(uint32_t)4096;

	 if(volt>=battery)
	 	return -1000;
	 
	 if(volt==0)
	 	return 1000;
	 
	 risister=volt*(uint32_t)resister*10/((uint32_t)battery-volt);

	for(i=0;i<sizeof(Risister_table)/4;i++)
	{
		if(risister>Risister_table[i+1]&&risister<=Risister_table[i])
			break;
		   }

	 if(i<sizeof(Risister_table)/4)
	 {
	 	temp=i-30;
	 	}

	 return temp;
}



